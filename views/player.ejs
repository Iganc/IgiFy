<!--&lt;!&ndash;THIS FILE IS HEAVILY INSPIRED BY: https://www.geeksforgeeks.org/create-a-music-player-using-javascript/&ndash;&gt;-->
<!--<head>-->
<!--    <style>-->
<!--        /*body #mini-player,*/-->
<!--        /*html #mini-player,*/-->
<!--        /*body div#mini-player {*/-->
<!--        /*    display: none !important;*/-->
<!--        /*    visibility: hidden !important;*/-->
<!--        /*    height: 0 !important;*/-->
<!--        /*    width: 0 !important;*/-->
<!--        /*    overflow: hidden !important;*/-->
<!--        /*}*/-->
<!--        html, body {-->
<!--            width: 100%;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            overflow-x: hidden;-->
<!--            background-color: #121212;-->
<!--            color: #ffffff;-->
<!--            font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;-->
<!--            transition: background-color 0.5s;-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            align-items: center;-->
<!--        }-->

<!--        main {-->
<!--            max-width: 100% !important;-->
<!--            width: 100%;-->
<!--            padding: 0 !important;-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            align-items: center;-->
<!--        }-->

<!--        /* Header and navigation styling */-->
<!--        header {-->
<!--            width: 100%;-->
<!--            display: flex;-->
<!--            justify-content: center;-->
<!--            background-color: #121212;-->
<!--        }-->

<!--        header nav,-->
<!--        header .container {-->
<!--            width: 100%;-->
<!--            max-width: 1200px;-->
<!--            margin: 0 auto;-->
<!--            padding: 0 20px;-->
<!--            box-sizing: border-box;-->
<!--        }-->

<!--        /* Player container */-->
<!--        .player {-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            min-height: calc(100vh - 130px); /* Account for header and mini-player */-->
<!--            width: 100%;-->
<!--            max-width: 1200px;-->
<!--            margin: 0 auto;-->
<!--            padding: 0;-->
<!--            box-sizing: border-box;-->
<!--        }-->

<!--        /* Track details section */-->
<!--        .details {-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            width: 100%;-->
<!--            margin-top: 25px;-->
<!--            padding: 0 20px;-->
<!--            box-sizing: border-box;-->
<!--            text-align: center;-->
<!--        }-->

<!--        .track-art {-->
<!--            width: min(280px, 30vh);-->
<!--            height: min(280px, 30vh);-->
<!--            margin: 25px auto;-->
<!--            background-size: cover;-->
<!--            background-position: center;-->
<!--            border-radius: 8px;-->
<!--            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);-->
<!--            transition: transform 0.3s ease;-->
<!--        }-->

<!--        .track-art:hover {-->
<!--            transform: scale(1.02);-->
<!--        }-->

<!--        .now-playing {-->
<!--            font-size: 0.8rem;-->
<!--            color: #b3b3b3;-->
<!--            letter-spacing: 1px;-->
<!--            text-transform: uppercase;-->
<!--            margin-bottom: 10px;-->
<!--        }-->

<!--        .track-name {-->
<!--            font-size: 2.2rem;-->
<!--            font-weight: 700;-->
<!--            margin-bottom: 8px;-->
<!--            text-align: center;-->
<!--            padding: 0 20px;-->
<!--        }-->

<!--        .track-artist {-->
<!--            font-size: 1.2rem;-->
<!--            color: #b3b3b3;-->
<!--            margin-bottom: 30px;-->
<!--        }-->

<!--        /* Player controls */-->
<!--        .buttons {-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            margin: 20px 0;-->
<!--            width: 100%;-->
<!--        }-->

<!--        .playpause-track,-->
<!--        .prev-track,-->
<!--        .next-track {-->
<!--            padding: 15px;-->
<!--            opacity: 0.8;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.2s ease;-->
<!--        }-->

<!--        .playpause-track:hover,-->
<!--        .prev-track:hover,-->
<!--        .next-track:hover {-->
<!--            opacity: 1.0;-->
<!--            transform: scale(1.1);-->
<!--        }-->

<!--        /* Icons */-->
<!--        i.fa-play-circle,-->
<!--        i.fa-pause-circle,-->
<!--        i.fa-step-forward,-->
<!--        i.fa-step-backward {-->
<!--            cursor: pointer;-->
<!--            color: #ffffff;-->
<!--        }-->

<!--        .fa-play-circle,-->
<!--        .fa-pause-circle {-->
<!--            font-size: 4rem !important;-->
<!--            color: #1db954;-->
<!--        }-->

<!--        .fa-step-backward,-->
<!--        .fa-step-forward {-->
<!--            font-size: 2rem !important;-->
<!--        }-->

<!--        /* Slider styles */-->
<!--        .slider_container {-->
<!--            width: 100%;-->
<!--            max-width: 800px;-->
<!--            padding: 0 20px;-->
<!--            box-sizing: border-box;-->
<!--            margin: 0 auto;-->
<!--        }-->

<!--        .seek_slider,-->
<!--        .volume_slider {-->
<!--            -webkit-appearance: none;-->
<!--            appearance: none;-->
<!--            height: 5px;-->
<!--            border-radius: 10px;-->
<!--            background: #535353;-->
<!--            opacity: 0.7;-->
<!--            transition: opacity 0.2s;-->
<!--        }-->

<!--        .seek_slider::-webkit-slider-thumb,-->
<!--        .volume_slider::-webkit-slider-thumb {-->
<!--            -webkit-appearance: none;-->
<!--            appearance: none;-->
<!--            width: 14px;-->
<!--            height: 14px;-->
<!--            background: #1db954;-->
<!--            cursor: pointer;-->
<!--            border-radius: 50%;-->
<!--            box-shadow: 0 2px 4px rgba(0,0,0,0.3);-->
<!--        }-->

<!--        .seek_slider:hover,-->
<!--        .volume_slider:hover {-->
<!--            opacity: 1.0;-->
<!--        }-->

<!--        .seek_slider {-->
<!--            width: 70%;-->
<!--        }-->

<!--        .volume_slider {-->
<!--            width: 30%;-->
<!--        }-->

<!--        .current-time,-->
<!--        .total-duration {-->
<!--            padding: 10px;-->
<!--            color: #b3b3b3;-->
<!--            font-size: 0.9rem;-->
<!--        }-->

<!--        i.fa-volume-down,-->
<!--        i.fa-volume-up {-->
<!--            padding: 10px;-->
<!--            color: #b3b3b3;-->
<!--        }-->

<!--        /* Back button */-->
<!--        .back-button {-->
<!--            position: fixed;-->
<!--            top: 70px;-->
<!--            left: 20px;-->
<!--            z-index: 100;-->
<!--            background-color: rgba(18, 18, 18, 0.7);-->
<!--            padding: 8px 12px;-->
<!--            border-radius: 4px;-->
<!--            text-decoration: none;-->
<!--            color: #b3b3b3;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            gap: 5px;-->
<!--            transition: all 0.2s ease;-->
<!--        }-->

<!--        .back-button:hover {-->
<!--            color: #ffffff;-->
<!--            background-color: rgba(29, 185, 84, 0.7);-->
<!--        }-->

<!--        /* Footer styles */-->
<!--        footer {-->
<!--            width: 100% !important;-->
<!--            left: 0;-->
<!--            right: 0;-->
<!--            display: flex;-->
<!--            justify-content: center;-->
<!--            box-sizing: border-box;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            background-color: #121212;-->
<!--        }-->

<!--        .footer-content {-->
<!--            width: 100%;-->
<!--            max-width: 1200px;-->
<!--            margin: 0 auto;-->
<!--            padding: 0 20px;-->
<!--            box-sizing: border-box;-->
<!--        }-->

<!--        /* Responsive styles */-->
<!--        @media only screen and (max-width: 600px) {-->
<!--            .track-art {-->
<!--                width: min(280px, 80vw);-->
<!--                height: min(280px, 80vw);-->
<!--            }-->

<!--            .track-name {-->
<!--                font-size: 1.8rem;-->
<!--            }-->

<!--            .track-artist {-->
<!--                font-size: 1rem;-->
<!--            }-->

<!--            .back-button {-->
<!--                top: 60px;-->
<!--                left: 10px;-->
<!--            }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<a href="/a/<%= album.type %>/<%= artist.name %>/<%= album.title %>" class="back-button">-->
<!--    <i class="fas fa-arrow-left"></i> Back to Album-->
<!--</a>-->

<!--<div class="player">-->
<!--    <div class="details">-->
<!--        <div class="now-playing">Track <%= currentTrackIndex + 1 %> of <%= tracks.length %></div>-->
<!--        <div class="track-art" style="background-image: url('/images/<%= album.image_cover_filename %>')"></div>-->
<!--        <div class="track-name"><%= song.title %></div>-->
<!--        <div class="track-artist"><%= artist.name %></div>-->
<!--    </div>-->

<!--    <div class="buttons">-->
<!--        <div class="prev-track" id="player-prev-track">-->
<!--            <i class="fa fa-step-backward"></i>-->
<!--        </div>-->
<!--        <div class="playpause-track" id="player-playpause-track">-->
<!--            <i class="fa fa-play-circle"></i>-->
<!--        </div>-->
<!--        <div class="next-track" id="player-next-track">-->
<!--            <i class="fa fa-step-forward"></i>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
<!--&lt;!&ndash;<audio id="audio-player" preload="metadata"></audio>&ndash;&gt;-->
<!--<script>-->
<!--    const track_list = [-->
<!--        <% tracks.forEach(function(track) { %>-->
<!--        {-->
<!--            id: <%= track.id %>,-->
<!--            title: "<%= track.title %>",-->
<!--            artist: "<%= artist.name %>",-->
<!--            coverUrl: "/images/<%= album.image_cover_filename %>",-->
<!--            audioUrl: "/images/<%= track.file_path %>"-->
<!--        },-->
<!--        <% }); %>-->
<!--    ];-->

<!--    let track_index = <%= currentTrackIndex %>;-->
<!--    const trackArt = document.querySelector(".track-art");-->
<!--    const trackName = document.querySelector(".track-name");-->
<!--    const trackArtist = document.querySelector(".track-artist");-->
<!--    const playPauseBtn = document.getElementById("player-playpause-track");-->
<!--    const prevBtn = document.getElementById("player-prev-track");-->
<!--    const nextBtn = document.getElementById("player-next-track");-->
<!--    const nowPlaying = document.querySelector(".now-playing");-->


<!--    // Add this to your player.ejs script section-->
<!--    document.addEventListener('DOMContentLoaded', () => {-->
<!--        // Hide mini-player with inline style-->
<!--        const miniPlayer = document.getElementById('mini-player');-->
<!--        if (miniPlayer) {-->
<!--            miniPlayer.style.cssText = 'display: none !important; visibility: hidden !important;';-->
<!--        }-->

<!--        // Set flag for mini-player to reappear on other pages-->
<!--        localStorage.setItem('resetMiniPlayer', 'true');-->

<!--        // Save current track info for the mini-player to use on other pages-->
<!--        if (typeof track_list !== 'undefined' && track_list[track_index]) {-->
<!--            // Get the audio element reference-->
<!--            const audioElement = document.getElementById('audio-player');-->

<!--            const currentTrack = track_list[track_index];-->
<!--            const trackInfo = {-->
<!--                id: currentTrack.id,-->
<!--                src: currentTrack.audioUrl,-->
<!--                title: currentTrack.title,-->
<!--                artist: currentTrack.artist,-->
<!--                coverUrl: currentTrack.coverUrl,-->
<!--                currentTime: audioElement ? audioElement.currentTime : 0,-->
<!--                isPlaying: audioElement ? !audioElement.paused : false-->
<!--            };-->
<!--            localStorage.setItem('currentTrack', JSON.stringify(trackInfo));-->
<!--        }-->

<!--        // Initialize player controls-->
<!--        setTimeout(() => loadTrackIntoMiniPlayer(track_index), 300);-->
<!--        playPauseBtn.addEventListener('click', togglePlayPause);-->
<!--        prevBtn.addEventListener('click', prevTrack);-->
<!--        nextBtn.addEventListener('click', nextTrack);-->
<!--        document.addEventListener('music-play', updatePlayButton);-->
<!--        document.addEventListener('music-pause', updatePlayButton);-->
<!--    });-->

<!--    function loadTrackIntoMiniPlayer(index) {-->
<!--        const track = track_list[index];-->

<!--        // Update the UI-->
<!--        trackName.textContent = track.title;-->
<!--        trackArtist.textContent = track.artist;-->
<!--        trackArt.style.backgroundImage = `url("${track.coverUrl}")`;-->
<!--        nowPlaying.textContent = `Track ${index + 1} of ${track_list.length}`;-->

<!--        // Check if audioController exists and has loadTrack method-->
<!--        if (window.audioController && typeof window.audioController.loadTrack === 'function') {-->
<!--            window.audioController.loadTrack({-->
<!--                id: track.id,-->
<!--                title: track.title,-->
<!--                artist: track.artist,-->
<!--                coverUrl: track.coverUrl,-->
<!--                audioUrl: track.audioUrl-->
<!--            });-->
<!--        } else {-->
<!--            const miniPlayerAudio = document.getElementById('audio-player');-->
<!--            if (miniPlayerAudio) {-->
<!--                miniPlayerAudio.src = track.audioUrl;-->
<!--                updatePlayButton();-->
<!--            }-->
<!--        }-->
<!--    }-->

<!--    function togglePlayPause() {-->
<!--        const miniPlayerAudio = document.getElementById('audio-player');-->
<!--        if (!miniPlayerAudio) return;-->

<!--        if (miniPlayerAudio.paused) {-->
<!--            miniPlayerAudio.play().catch(err => console.error('Playback error:', err));-->
<!--        } else {-->
<!--            miniPlayerAudio.pause();-->
<!--        }-->
<!--        updatePlayButton();-->
<!--    }-->

<!--    function updatePlayButton() {-->
<!--        const miniPlayerAudio = document.getElementById('audio-player');-->
<!--        if (!miniPlayerAudio) return;-->

<!--        if (miniPlayerAudio.paused) {-->
<!--            playPauseBtn.innerHTML = '<i class="fa fa-play-circle"></i>';-->
<!--        } else {-->
<!--            playPauseBtn.innerHTML = '<i class="fa fa-pause-circle"></i>';-->
<!--        }-->
<!--    }-->

<!--    function nextTrack() {-->
<!--        if (track_index < track_list.length - 1) {-->
<!--            track_index += 1;-->
<!--        } else {-->
<!--            track_index = 0;-->
<!--        }-->
<!--        loadTrackIntoMiniPlayer(track_index);-->
<!--    }-->

<!--    function prevTrack() {-->
<!--        if (track_index > 0) {-->
<!--            track_index -= 1;-->
<!--        } else {-->
<!--            track_index = track_list.length - 1;-->
<!--        }-->
<!--        loadTrackIntoMiniPlayer(track_index);-->
<!--    }-->

<!--    // Add this at the end of your player.ejs script section-->
<!--    window.addEventListener('beforeunload', () => {-->
<!--        // Get current playback state before page unload-->
<!--        const audioElement = document.getElementById('audio-player');-->
<!--        if (!audioElement) return;-->

<!--        // Save the exact state including whether it was playing-->
<!--        const wasPlaying = !audioElement.paused;-->
<!--        const currentTime = audioElement.currentTime;-->

<!--        // Store current track with enhanced info-->
<!--        if (track_list && track_index >= 0 && track_index < track_list.length) {-->
<!--            const currentTrack = track_list[track_index];-->
<!--            const trackInfo = {-->
<!--                id: currentTrack.id,-->
<!--                src: currentTrack.audioUrl,-->
<!--                title: currentTrack.title,-->
<!--                artist: currentTrack.artist,-->
<!--                coverUrl: currentTrack.coverUrl,-->
<!--                currentTime: currentTime,-->
<!--                isPlaying: wasPlaying,-->
<!--                timestamp: Date.now()-->
<!--            };-->

<!--            localStorage.setItem('currentTrack', JSON.stringify(trackInfo));-->
<!--            localStorage.setItem('playerState', wasPlaying ? 'playing' : 'paused');-->
<!--        }-->
<!--    });-->
<!--</script>-->
<!--</body>-->
